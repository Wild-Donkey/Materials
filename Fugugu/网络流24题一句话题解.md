# 网络流24题一句话题解

因为是给我自己看的，所以很多地方不那么严谨（（

## P2756 飞行员配对方案问题

裸的二分图匹配。时间复杂度 $O(nm \sqrt {mn})$。

## P2761 软件补丁问题

假题，出题人本意大概是用 dij/spfa 在有环图上做 dp 转移，但是本题的边数达到了 $10^8$，并没有什么合适的算法来转移。

## P4016 负载平衡问题

没什么意思的费用流问题。考虑可以通过流量限制来满足各个仓库存量相同的限制。把仓库间转移费用设为 $1$，最小化费用即可。

建立超级源点流向每个仓库，流量为初始仓库存量，代表每个仓库的初始状态。

建立超级汇点，每个仓库连向超级汇点，流量位平均值，代表最终存量要相同

相邻仓库间互相连边，容量位INF，费用为 $1$，代表货物在仓库间的运输。

显而易见，最大流增广结束时，每个仓库到汇点的流量都是均值，满足了题目要求的条件。

时间复杂度 $O(n^3)$。

## P2765 魔术球问题

显而易见答案具有单调性，因此考虑二分答案来判断是否可行。

考虑对每个球建立一个点，如果一个球 $u$ 的上面可以放另一个球 $v$ 则连一条 $u \rightarrow v$ 的边。显然这是一个 DAG，图中的任意一条通路都可以代表一根柱子。而我们的目标是最小化柱子数，也即选择尽可能少的无交通路来覆盖整张图。这是一个 DAG 的最小路径覆盖问题，根据有关定理，答案即为点数-拆点后的最大匹配数。

当然，因为这张图的点数与答案数是同阶的，所以直接从小到大枚举答案判断即可。

时间复杂度 $O(ans^3)$。

## P4011 孤岛营救问题

状压以后跑 01 bfs 即可。因为不是网络流所以只是嘴巴切了。

## P4009 汽车加油行驶问题

裸的分层图最短路。转移的时候枚举一下边即可。和软件补丁问题不同的是，用 dij 跑最短路的复杂度是对的。

## P2774 方格取数问题

注意到一个被选择的点的上下左右都不能选，显而易见可以通过行列编号奇偶性是否相同来建立一张二分图，对于每个格子向它上下左右连边即可。所求即为二分图最大带权点独立集。

## P3355 骑士共存问题

这也是一道方格题，同时发现对于不能选的两个点，如果在他们之间连边，同样得到的图是一个二分图。

那么同样求最大独立集即可，只不过这次不带权了。

## P2762 太空飞行计划问题

这大概就是传说中的最大权闭合子图了？

其实本质上是求总收益 - 尽可能小的亏损。而尽可能小的亏损可以用最小割解决。

## P3254 圆桌问题

单位向餐桌连边，容量为 $1$，源点向单位连边，容量为人数，餐桌向汇点连边，容量为餐桌容量。最大流即可。

## P2770 航空路线问题

本质上是求两条除起终点外无交的从左到右的通路。把原图拆点，代表一个城市只能经过一次，原图的边保留。为了保证两条通路，考虑从源点只流出 $2$ 的流量即可。为了保证城市数尽可能多，把每个城市拆出来的两点之间的边费用置为 $1$，跑最大费用最大流即可。

## P2754 星际转移问题

这是一道经典的分层图问题。

同样考虑二分答案，注意到在各个时间节点同一星球能转移的情况是不同的，因此按照时间对星球分层即可。两层之间相同星球的对应节点记得连一条边代表在该星球原封不动待到下一个时刻。求最大流即为当前答案下最多能运送多少人。

## P1251 餐巾计划问题

最妙的一题。

考虑每一天的职能有两个，分别是消耗掉一定量的干净餐巾和产生同样数量的脏餐巾。因此我们把每一天拆成两个点，分别处理这两种职能。

为了保证每天消耗的餐巾符合要求，我们直接把消耗点向汇点连结容量为对应天的消耗量，费用为 $0$ 的边，这样在漫流时即可保证消耗符合要求。但是这样产生的脏餐巾就不能由消耗点给出了，我们直接从源点给出这些脏餐巾即可。

对于产生的脏餐巾，可以送洗后给后面的某天用来消耗，因此产生脏餐巾的点向清洗天数后的对应节点连结容量无穷，费用为对应费用的边即可。当然，可以把脏餐巾存起来延期送洗，因此每一天的产生点要向下一天的产生点连边。

而对于购买新餐巾的情况，同样直接从源点购买即可。

跑最小费用最大流即可。

总结一下这种题的思维方向是想办法构造一种图，使得该图满流的情况下符合题目的要求，也即将“最大流”作为最优化问题的限制，将“最大/小费用”作为最优化的目标。在考虑建图的时候应该首先考虑流量的要求，而不是直接上手去分析费用。

常见的要求满足最大流的方法即为从源/汇点连出/入的边流量为限制即可。需要根据此限制来完善其他边的构建方法。例如本题中为了保证满流时合法，将消耗点直接连向了汇点，因此构建了源点到产生点的边。

## P2763 试题库问题

裸的最大流。试题连类型，为了保证每个题只能用一次，源点向试题的容量为 $1$；为了保证类型满足要求，类型连向汇点的容量为该类型的要求。跑最大流即可判断解的存在性。

## P2766 最长不下降子序列问题

第一问 DP。

对于第二问，考虑对序列建图，如果 $i < j$ 并且 $a_i \leq a_j$ 就连一条 $<i \rightarrow j>$ 的边。考虑一个长度为 $s$ 的不下降子序列一定对应图上的一条长度为 $s$ 的通路。

考虑源点向所有 dp 值为 $1$ 的点连边，所有 dp 值为 $s$ 的点向汇点连边，这样任意一条流量都一定流过了 $s$ 的长度，也即每一条流量都对应了一个长度为 $s$ 的不下降子序列。为了保证每个数只用一次，拆点跑最大流即可。

对于第三问，把有关的边容量改成无穷再跑即可。

## P2764 最小路径覆盖问题

先将 $n$ 个点用单独的路线覆盖，然后考虑每次合并两个点，答案都会减小 $1$。因此我们要尽可能合并更多的点。

考虑一个点只会连接一个入边和一个出边，因此考虑拆点，拆成出入两点，两点之间不连边，原图中的边对应到新图上去，这样就形成了一个二分图，图上每选择一条边即意味着合并了两个点。因此求最大匹配即可。

## P4014 分配问题

没啥好说的，裸的费用流。

## P4015 运输问题

依然是裸的费用流。

## P4012 深海机器人问题

考虑一条边上的生物标本只能采集一次，但是边可以经过很多次，因此考虑把原来的边拆成两条，一条容量为 $1$，费用为标本价值，代表采集该点，另一条容量为无穷，费用为 $0$，代表经过这条边但是标本已经被采集过了。

求最大费用最大流即可。

## P3356 火星探险问题 

和上个题基本一致。

## P3358 最长k可重区间集问题

考虑对所有的坐标，因为只能选 $k$ 个，因此对所有坐标拆点，连结一条容量为 $k$ 的边，费用为 $0$。对于每条线段，从左端点出点到右端点入点连结一条容量为 $1$，费用为长度的边，代表该线段。注意到对于同一个坐标，与其有关的所有边是“并联”的，即通过他们的总流量一定等于源点流出的流量。如果无法理解可以用一条水流流过来类比。

因为所有坐标的有关边总流量最多为 $k$，因此从源点流出最多 $k$ 的流量，跑最大费用最大流即可。

## P3357 最长k可重线段集问题

和上个题基本一致。

## P4013 数字梯形问题

对于每个数字只能用一次的限制，考虑拆点即可做到。

对于边只能用一次的限制，考虑限制边的流量为 $1$ 即可左到。

对于第二条和第三条，放开上面两个限制即可。

为了保证有 $m$ 条路径，所以要求最大流。为了最大化结果，所以要最大费用。

## P2775 机器人路径规划问题

这又是一道假题。